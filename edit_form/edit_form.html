<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" type="text/css" href="style/other.css">-->
    <title>第十六周作业----后台管理平台</title>
    <style>
        li{
            padding-top: 10px;
        }
        .hide{
            display: none;
        }
        .modal{
            position: fixed;
            top: 50%;
            left: 50%;
            width: 600px;
            height: 400px;
            margin-left: -400px;
            margin-top: -200px;
            background-color: #eeeeee;
            z-index: 10;
        }
        .modalItem span{
            display: inline-block;
            width: 80px;
            text-align: right;
        }
        .shadow{
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.6;
            background-color: black;
            z-index: 9;
        }
        .reset-btn, .cancel-btn{
            margin-left: 15px;
        }
        .edit-mode{
            background-color: #ffae2c;
            width: 150px;
            height: 24px;
            display: inline-block;
            color: white;
            text-align: center;
            line-height: 24px;
        }
        .edit-mode:hover{
            cursor: pointer;
        }
        .editing {
            background-color: red;
            /*$(this).css('backgroundColor', 'red');*/
        }
    </style>
</head>
<body>
<div style="width: 600px;height: 400px;border: 1px solid #dddddd;">
    <!--操作按钮栏-->
    <div style="height: 50px;line-height: 50px;background-color: #d6ffdf">
        <input type="button" value="全选" onclick="checkAll()">
        <input type="button" value="反选" onclick="reverseAll()">
        <input type="button" value="取消" onclick="cancleAll()">
        <a id="edit-mode" class="edit-mode">进入编辑模式</a>
    </div>

    <!--内容区域-->
    <div>
        <table border="1" id="tb">
            <thead>
                <tr>
                    <th width="40px;">选择</th>
                    <th width="100px;">主机名</th>
                    <th width="100px">主机IP</th>
                    <th width="40px;">端口</th>
                    <th width="40px;">状态</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="checkbox" title="选择"></td>
                    <td target="hostname">111</td>
                    <td target="ip">1.1.1.1</td>
                    <td target="port">80</td>
                    <td target="status">
                        <select title="状态" class="info-selector" disabled="disabled">
                            <option value="online" selected="selected">在线</option>
                            <option value="outline">下线</option>
                        </select>
                    </td>
                    <td>
                        <a class="edit-option">编辑</a> | <a class="del">删除</a>
                    </td>
                </tr>
                <tr>
                    <td><input type="checkbox" title="选择"></td>
                    <td target="hostname">222</td>
                    <td target="ip">2..2.2.2</td>
                    <td target="port">80</td>
                    <td target="status">
                        <select title="状态" class="info-selector" disabled="disabled">
                            <option value="online" selected="selected">在线</option>
                            <option value="outline">下线</option>
                        </select>
                    </td>
                    <td>
                        <a class="edit-option">编辑</a> | <a class="del">删除</a>
                    </td>
                </tr>
                <tr>
                    <td><input type="checkbox" title="选择"></td>
                    <td target="hostname">333</td>
                    <td target="ip">3.3.3.3</td>
                    <td target="port">80</td>
                    <td target="status">
                        <select title="状态" class="info-selector" disabled="disabled">
                            <option value="online">在线</option>
                            <option value="outline" selected="selected">下线</option>
                        </select>
                    </td>
                    <td>
                        <a class="edit-option">编辑</a> | <a class="del">删除</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div style="width: 400px;height: 400px;border: 1px solid #dddddd;background-color: #ff5018;">
    <div style="float: left;width: 400px;height: 400px;background-color: #ffb822;">
        <h3>后台管理平台，编辑表格：</h3>
        <ol>
            <li>
                非编辑模式：
                <ul>
                    <li>可对每行进行选择</li>
                    <li>全选</li>
                    <li>反选</li>
                    <li>取消选择</li>
                </ul>
            </li>
            <li>
                编辑模式：
                <ul>
                    <li>进入编辑模式时如果行被选中，则被选中的行变为可编辑状态，未选中的不改变</li>
                    <li>退出编辑模式时，所有的行进入非编辑状态</li>
                    <li>处于编辑模式时，行被选中则进入编辑状态，取消选择则进入非编辑状态</li>
                </ul>
            </li>
        </ol>
    </div>
</div>
<div class="modal hide">
    <div class="modalItem">
        <p>
            <span>主机名：</span>
            <input name="hostname" type="text" title="hostname"/>
        </p>
        <p>
            <span>主机IP：</span>
            <input name="ip" type="text" title="ip"/>
        </p>
        <p>
            <span>端口：</span>
            <input name="port" type="text"  title="port"/>
        </p>
        <p>
            <span>状态：</span>
            <select name="status" title="状态" class="set-selector">
                <!--<option value="none">&#45;&#45;&#45;&#45;</option>-->
                <option value="online">在线</option>
                <option value="outline" selected="selected">下线</option>
            </select>
        </p>
    </div>

    <div style="padding-left: 85px">
        <input class="confirm-btn" type="button" value="确定" onclick="confirmModal();" />
        <input class="cancel-btn" type="button" value="取消" onclick="cancelModal();" />
        <input class="reset-btn" type="reset" value="重置" onclick="resetModal();" />
        <!--<input class="confirm-btn" type="button" value="确定" />-->
        <!--<input class="cancel-btn" type="button" value="取消" />-->
        <!--<input class="reset-btn" type="reset" value="重置" />-->
    </div>
</div>

<div class="shadow hide"></div>

<script src="js/jquery-1.12.4.min.js"></script>
<script>
    var ths;  // 记录当前编辑行的位置
    var confirm_type;  //记录弹出框的弹出类型(添加/编辑)
    // 全选
    function checkAll() {
        // 在id="tb"下面查找表单":checkbox",并设置checked状态为true
        //language=JQuery-CSS
        $("#tb").find(":checkbox").prop("checked", true);
    }

    // 取消
    function cancleAll() {
        // 在id="tb"下面查找表单":checkbox",并设置checked状态为false
        $("#tb").find(":checkbox").prop("checked", false);
    }

    // 反选
    function reverseAll() {
        $("#tb").find(":checkbox").each(function () {
            // 循环判断每一个元素, 并设置
            /*
            if ($(this).prop("checked")) {
                $(this).prop("checked", false);
            } else {
                $(this).prop("checked", true);
            }
            */
            // 利用! 进行非操作
            $(this).prop("checked", !$(this).prop("checked"));
        });
    }

    // 删除
    $('.del').click(function () {
        $(this).parent().parent().remove();
    });

    // 编辑
    $('.edit').click(function(){
        // 编辑时不需要重置按钮,隐藏
        $('.modal').find('.reset-btn').addClass('hide');
        // 弹出遮罩层 修改框
        $(".modal,.shadow").removeClass('hide');
        ths = $(this).parent().parent();
        confirm_type = 'edit';
         var tds = $(this).parent().prevAll();
        tds.each(function () {
            // 获取td的target属性值
            var n = $(this).attr('target');
            if (n === 'status') {
                // 获取select的属性
                var select_val = $(this).find('select option:selected').val();
                $('.modal').find('select').val( select_val);
            } else {
                // 获取td中的内容
                var text = $(this).text();
                var a1 = '.modal input[name="';
                var a2 = '"]';
                var temp = a1 + n + a2;
                $(temp).val(text);
            }
        });
    });

    // 取消
    // 隐藏modal/shadow, 清空输入信息
    function cancelModal() {
        $(".modal,.shadow").addClass('hide');
        $('.modal input[type="text"]').val("");
    }

    // 确定
    function confirmModal() {
        // 编辑状态
        if (confirm_type === 'edit'){
            // 隐藏modal/shadow
            $(".modal,.shadow").addClass('hide');
            // 获取当前正在编辑的行数据
            // 获取class="modal"下面的主机名、主机IP、端口、状态
            var ps = $('.modal p');
            console.log(ths);
            ps.each(function () {
                // 获取p下面input的name属性值,this代指当前的p
                var tar = $(this).find(':input').attr('name');
                var t1 = 'td[target="';
                var t2 = '"]';
                var temp = t1 + tar + t2;
                if (tar === 'status'){
                    // 获取新的状态值
                    var currStatus = $('.set-selector').val();
                    $(ths).find(temp).find('select').val(currStatus);
                }else {
                    var val = $(this).find(':input').val();
                    console.log($(ths).find(temp));
                    $(ths).find(temp).text(val);
                }
            });
        }
    }

    // 点击进入编辑模式
    $('#edit-mode').click(function () {
        $(this).toggleClass('editing');
        if ($(this).hasClass('editing')){
            $(this).text('退出编辑模式');
            // 查找已选择的行
            $("#tb").find(":checkbox").each(function () {
            // 循环判断每一个元素, 对于选中的行添加input标签
             if ($(this).prop("checked")) {
//                 console.log("checked", $(this).parent().siblings());
                 var tds = $(this).parent().siblings();
                 console.log("true", tds);
                 tds.each(function () {
                     console.log("111", [this][0]);
                     if ($(this).hasClass('edit-option')){
                         console.log('edit-option', [this][0]);
                     }else {
                         if ($(this).hasClass('info-selector')){
                             console.log('select', [this][0]);
                         }else {
                             console.log('2222',[this][0]);
                             var v = $(this).text();
                             var temp1 = '<input value="';
                             var temp2 = '" />';
                             var temp = temp1 + v + temp2;
                             $(this).html(temp);
                         }
                     }
                 });
             } else {
//                 $(this).prop("checked", true);
                 console.log("false");
             }
        });
        }else {
            $(this).text('点击进入编辑模式');
        }
    })

</script>
</body>
</html>